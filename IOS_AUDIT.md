# Ari Esthetician App — iOS Compliance & Readiness Audit

**Audit Date:** January 30, 2026  
**Last Updated:** January 30, 2026  
**Author:** Kevin Doyle Jr. / Infinitum Imagery LLC  
**Scope:** iOS platform configuration, Info.plist, Podfile, Firebase/Stripe setup, App Store compliance, and Dart code paths used on iOS.

---

## Executive Summary

The Ari Esthetician App has been **audited for iOS** and **iOS platform support has been added** (previously the project had no `ios/` folder). The following was done:

1. **iOS platform added** via `flutter create --platforms=ios .`
2. **Info.plist** updated with **LSApplicationQueriesSchemes** (required for `url_launcher` on iOS so `canLaunchUrl`/`launchUrl` work for App Store and web links).
3. **Podfile** and Xcode project updated to **iOS 15.0** minimum (required by cloud_firestore 6.x and Firebase iOS SDK).
4. **Dart code** already uses platform-safe patterns (`kIsWeb`, `defaultTargetPlatform == TargetPlatform.iOS`, `dart.library.io` for device_metadata_service_io) and does not rely on web-only or Android-only APIs on iOS.

**Before submitting to the App Store you must:**

- Run **`flutterfire configure`** and add an **iOS app** in Firebase Console so that `firebase_options.dart` includes iOS and `GoogleService-Info.plist` is generated/placed in `ios/Runner/`.
- Replace placeholder **App Store URL** in `lib/screens/update_required_screen.dart` with your real App Store link once the app is published.
- Configure **signing & capabilities** in Xcode (team, bundle ID, provisioning).
- If you add **push notifications** (Firebase Cloud Messaging) later, add the Push Notifications capability and `UIBackgroundModes` → `remote-notification` in Info.plist.

---

## 1. iOS Platform Status

| Item | Status |
|------|--------|
| `ios/` folder | ✅ Present (created via `flutter create --platforms=ios .`) |
| Runner target, AppDelegate, Info.plist | ✅ Present |
| Podfile | ✅ Present, platform set to 15.0 |
| Xcode project (Runner.xcodeproj) | ✅ Present |
| Launch screen & app icons | ✅ Default placeholders (replace with brand assets if desired) |

---

## 2. Build Configuration

### 2.1 Minimum iOS Version

- **Podfile:** `platform :ios, '15.0'` (explicit). Required by cloud_firestore 6.x and Firebase iOS SDK.
- **Xcode project:** `IPHONEOS_DEPLOYMENT_TARGET = 15.0` (in `project.pbxproj`).
- **App constants:** `lib/core/constants/app_constants.dart` defines `minIOSVersion = 15` to match the iOS 15.0 build minimum (cloud_firestore 6.x and Firebase iOS SDK).

### 2.2 Podfile

- CocoaPods stats disabled (`COCOAPODS_DISABLE_STATS`).
- `use_frameworks!` and Flutter pod setup are standard.
- No custom native modules; plugins are managed by Flutter.

---

## 3. Info.plist Compliance

### 3.1 Keys Present (Required / Recommended)

| Key | Purpose |
|-----|---------|
| `CFBundleDisplayName` | ✅ "Aris Esthetician App" |
| `CFBundleShortVersionString` / `CFBundleVersion` | ✅ From Flutter build name/number |
| `LSRequiresIPhoneOS` | ✅ true |
| `UILaunchStoryboardName` / `UIMainStoryboardFile` | ✅ LaunchScreen, Main |
| `UISupportedInterfaceOrientations` (iPhone & iPad) | ✅ Portrait, landscape |
| **LSApplicationQueriesSchemes** | ✅ **Added** — Required for `url_launcher` on iOS so `canLaunchUrl()` and `launchUrl()` work. Includes: `https`, `http`, `itms-apps`, `tel`, `mailto`, `sms`. |

### 3.2 Keys Not Yet Required (Add When Feature Is Used)

| Key | When to add |
|-----|-------------|
| `NSPhotoLibraryUsageDescription` | When using photo library / image picker |
| `NSCameraUsageDescription` | When using camera |
| `NSMicrophoneUsageDescription` | When recording video/audio |
| `NSLocationWhenInUseUsageDescription` | When using location |
| `UIBackgroundModes` → `remote-notification` | When using Firebase Cloud Messaging for push |

The app does **not** currently use `image_picker`, camera, or FCM in Dart; no push notification code was found. When you add these features, add the corresponding Info.plist keys and entitlements.

### 3.3 App Transport Security (ATS)

- No custom ATS overrides in Info.plist. Opening `https://` URLs (e.g. App Store, web) is allowed by default. No change needed unless you open non-HTTPS URLs and must document an exception.

---

## 4. Firebase iOS Setup (Required Before Running on Device/Simulator)

### 4.1 firebase_options.dart

- **Location:** `lib/core/config/firebase_options.dart` (gitignored; generated by FlutterFire.)
- **Current state:** File is not in repo; typically contains web config and placeholders for native.
- **Action:** Run **`flutterfire configure`** from project root. Ensure an **iOS app** is registered in Firebase Console and linked. This will:
  - Generate/update `firebase_options.dart` with **iOS** (and other platforms).
  - Optionally place **GoogleService-Info.plist** in `ios/Runner/` (or you add it manually from Firebase Console).

### 4.2 GoogleService-Info.plist

- **Location:** `ios/Runner/GoogleService-Info.plist` (gitignored in project `.gitignore`).
- **Action:** Must be present for Firebase (Auth, Firestore, etc.) on iOS. Get it from Firebase Console → Project settings → Your iOS app → Download `GoogleService-Info.plist`, then add it to the Runner target in Xcode (or copy into `ios/Runner/` and add to project).

### 4.3 firebase_config.dart

- Uses `DefaultFirebaseOptions.currentPlatform` and `Firebase.initializeApp(options: options)`. No iOS-specific code; persistence is set only for web (`kIsWeb`). **No code change needed for iOS.**

---

## 5. App Store & Privacy Compliance

### 5.1 Privacy Manifest (Apple Requirement as of May 2024)

- **Requirement:** New and updated apps must include privacy manifest support. Flutter 3.19+ and many plugins now ship with or support privacy manifests.
- **Action:** Use a **recent Flutter SDK** (3.19+) and keep **Firebase, Stripe, and other plugins** updated so they include privacy manifests where required. No app-level privacy manifest file was added in this audit; rely on Flutter and plugin manifests unless Apple or Xcode requests one for your app target.

### 5.2 App Store Metadata and URLs

- **Update Required screen:** `lib/screens/update_required_screen.dart` uses a placeholder iOS App Store URL (`https://apps.apple.com/app/aris-esthetician-app`). **Replace with your real App Store URL** once the app is published so the “Update from App Store” button works correctly.
- **Bundle ID:** Set in Xcode; must match the app registered in Firebase and App Store Connect.

### 5.3 Signing & Capabilities

- Configure in Xcode: **Signing & Capabilities** for the Runner target (Team, Bundle Identifier, provisioning profile). Add capabilities (e.g. Push Notifications) only when you use them.

---

## 6. Dart Code Audit for iOS

### 6.0 Dart Fix for iOS Build (admin_services_screen + html_stub)

- **admin_services_screen.dart** uses a conditional import for `dart:html` (web) vs **html_stub.dart** (iOS/Android). The stub’s `IFrameElement.style` is typed as `Style?`. The call `..style.display = 'none'` was changed to `..style?.display = 'none'` so the iOS build compiles without "Property 'display' cannot be accessed on 'Style?' because it is potentially null."

### 6.1 Platform Detection

- **main.dart:** No iOS-specific logic; Firebase and router work on all platforms.
- **firebase_config.dart:** Uses `kIsWeb` only for auth persistence; iOS uses default behavior. ✅
- **update_required_screen.dart:** Uses `kIsWeb` and `defaultTargetPlatform == TargetPlatform.iOS` for copy and App Store URL; `launchUrl`/`canLaunchUrl` now supported on iOS via LSApplicationQueriesSchemes. ✅
- **device_metadata_service.dart:** Conditional imports: `dart.library.io` → `device_metadata_service_io.dart` (uses `Platform.isIOS`); `dart.library.html` → web. On iOS, the IO implementation is used. ✅
- **admin_services_screen.dart:** Uses `kIsWeb` for PDF (web vs mobile); on iOS, `_handleMobilePDF` is used. ✅

### 6.2 No Web-Only or Android-Only Code on iOS Path

- No `dart:html` or web-only APIs are used on the iOS code path; conditional imports and `kIsWeb` guard web-only behavior.
- `device_metadata_service_io.dart` uses `dart:io` Platform; this is not used on web (web uses `device_metadata_service_web.dart`). ✅

### 6.3 Stripe (flutter_stripe)

- **payment_service.dart** initializes Stripe with publishable key and uses Cloud Functions for payment intents. No iOS-specific code; plugin handles platform. Ensure **flutterfire configure** and **GoogleService-Info.plist** are set so Cloud Functions and Firebase Auth work on iOS. No extra Info.plist keys required for Stripe in this setup.

### 6.4 Firebase Messaging

- **pubspec.yaml** includes `firebase_messaging`; no usage found in `lib/`. If you add push notifications later, you must:
  - Add Push Notifications capability in Xcode.
  - Add `UIBackgroundModes` → `remote-notification` in Info.plist.
  - Implement FCM token handling and optional notification handlers in Dart.

---

## 7. Dependencies Relevant to iOS

| Package | iOS notes |
|--------|-----------|
| firebase_core, firebase_auth, cloud_firestore, cloud_functions, firebase_storage, firebase_messaging | Require GoogleService-Info.plist and firebase_options with iOS. Run `flutterfire configure`. |
| flutter_stripe | Works on iOS; no extra plist keys for current usage. |
| url_launcher | LSApplicationQueriesSchemes added in Info.plist. ✅ |
| package_info_plus | Works on iOS. |
| shared_preferences | Works on iOS. |
| printing | Used for PDF on non-web; iOS uses mobile path. ✅ |

---

## 8. Pre–App Store Checklist

- [ ] Run **`flutterfire configure`** and add/link iOS app in Firebase.
- [ ] Add **GoogleService-Info.plist** to `ios/Runner/` and to the Runner target in Xcode.
- [ ] Confirm **firebase_options.dart** includes iOS (generated by flutterfire configure).
- [ ] In Xcode: set **Bundle ID**, **Team**, and **Signing** for Runner.
- [ ] Replace **App Store URL** placeholder in `update_required_screen.dart` with real link when app is live.
- [ ] Test **Firebase Auth and Firestore** on iOS simulator or device.
- [ ] Test **Update Required** flow on iOS (version check and “Update from App Store” button if applicable).
- [ ] (Optional) Replace default **app icons and launch screen** with brand assets.
- [ ] When adding **push notifications**: add capability and `UIBackgroundModes` → `remote-notification`; when adding **photo/camera**: add NSPhotoLibraryUsageDescription / NSCameraUsageDescription.

---

## 9. Build Commands (Reference)

```bash
# From project root
flutter pub get
cd ios && pod install --repo-update && cd ..
flutter build ios
# Or run from Xcode: open ios/Runner.xcworkspace
flutter run -d <ios-device-or-simulator-id>
```

**Note:** If `pod install` fails with "higher minimum deployment target," ensure Podfile has `platform :ios, '15.0'` and project.pbxproj has `IPHONEOS_DEPLOYMENT_TARGET = 15.0`. If pods fail to resolve, run `pod install --repo-update`. Building for a **physical device** requires code signing (Team, provisioning profile) in Xcode; use simulator or `flutter run -d <simulator-id>` to test without signing.

---

## 10. Summary Table

| Category | Status |
|----------|--------|
| iOS platform | ✅ Added |
| Info.plist (LSApplicationQueriesSchemes) | ✅ Added for url_launcher |
| Podfile (platform :ios) | ✅ Set to 15.0 |
| Dart code paths for iOS | ✅ Platform-safe; no web-only on iOS |
| Firebase iOS (firebase_options + GoogleService-Info.plist) | ⚠️ Required: run flutterfire configure and add plist |
| App Store URL in app | ⚠️ Replace placeholder when app is published |
| Privacy manifest | ✅ Rely on Flutter 3.19+ and updated plugins |
| Push / photo / camera | Not used; add plist keys when feature is added |

---

*End of iOS audit. The app is configured for iOS build and compliance; complete Firebase and signing steps above before device run and App Store submission.*
